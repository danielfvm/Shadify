var WebShaderWallpaper;(()=>{"use strict";var t={549:function(t,e){var i,s=this&&this.__awaiter||function(t,e,i,s){return new(i||(i=Promise))((function(r,a){function n(t){try{h(s.next(t))}catch(t){a(t)}}function o(t){try{h(s.throw(t))}catch(t){a(t)}}function h(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(n,o)}h((s=s.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.WebShaderWallpaper=void 0,function(t){function e(t,e,i){const s=t.createShader(i);if(t.shaderSource(s,e),t.compileShader(s),!t.getShaderParameter(s,t.COMPILE_STATUS))throw`Could not compile WebGL program. \n\n${t.getShaderInfoLog(s)}`;return s}class i{constructor(t,i){if(this.running=!0,this.eventHandlerResize=this.resize.bind(this),this.eventHandlerMouse=this.mouse.bind(this),this.quality=2,this.speed=1,this.canvas=document.createElement("canvas"),this.target=i,i.append(this.canvas),i!==document.body){const t=getComputedStyle(i).borderRadius||0;i.style.clipPath=`inset(0 0 0 0 round ${t})`}this.canvas.style.position="fixed",this.canvas.style.left="0%",this.canvas.style.right="0%",this.canvas.style.top="0%",this.canvas.style.bottom="0%",this.canvas.style.width="100%",this.canvas.style.height="100%",this.canvas.style.zIndex="-1",this.updateAttributes(),this.gl=this.canvas.getContext("webgl")||this.canvas.getContext("experimental-webgl"),this.pid=this.gl.createProgram(),this.vert=e(this.gl,"\n      attribute vec2 coords;\n      void main(void) {\n          gl_Position = vec4(coords.xy, 0.0, 1.0);\n      }\n  ",this.gl.VERTEX_SHADER),this.gl.attachShader(this.pid,this.vert),this.frag=e(this.gl,t,this.gl.FRAGMENT_SHADER),this.gl.attachShader(this.pid,this.frag),this.gl.linkProgram(this.pid),this.gl.useProgram(this.pid);let s=new Float32Array([-1,3,-1,-1,3,-1]);this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.gl.createBuffer()),this.gl.bufferData(this.gl.ARRAY_BUFFER,s,this.gl.STATIC_DRAW);let r=this.gl.getAttribLocation(this.pid,"coords");this.gl.vertexAttribPointer(r,2,this.gl.FLOAT,!1,0,0),this.gl.enableVertexAttribArray(r),this.uniformResolution=this.gl.getUniformLocation(this.pid,"resolution"),this.uniformTime=this.gl.getUniformLocation(this.pid,"time"),this.uniformMouse=this.gl.getUniformLocation(this.pid,"mouse"),window.addEventListener("resize",this.eventHandlerResize),window.addEventListener("mousemove",this.eventHandlerMouse),new MutationObserver((t=>{this.updateAttributes()})).observe(i,{subtree:!1,childList:!1,attributes:!0,attributeFilter:["data-shader","data-shader-quality","data-shader-speed"]}),this.update()}updateAttributes(){var t,e,i;this.quality=Number(null===(t=this.target.attributes.getNamedItem("data-shader-quality"))||void 0===t?void 0:t.value)||this.quality,this.speed=Number(null===(e=this.target.attributes.getNamedItem("data-shader-speed"))||void 0===e?void 0:e.value)||this.speed,(null===(i=this.target.attributes.getNamedItem("data-shader"))||void 0===i?void 0:i.value)||this.destroy(),this.resize(),console.log("resize",this,this.speed)}resize(){this.canvas.width=window.innerWidth/this.quality,this.canvas.height=window.innerHeight/this.quality}mouse(t){this.mouseX=t.clientX,this.mouseY=t.clientY}update(){const{width:t,height:e}=this.canvas;this.running&&(this.gl.uniform2f(this.uniformMouse,this.mouseX/t/this.quality,1-this.mouseY/e/this.quality),this.gl.uniform2f(this.uniformResolution,t,e),this.gl.uniform1f(this.uniformTime,performance.now()/1e3*this.speed),this.gl.viewport(0,0,t,e),this.gl.clearColor(0,0,0,0),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this.gl.drawArrays(this.gl.TRIANGLES,0,3),requestAnimationFrame(this.update.bind(this)))}destroy(){this.target.shaderWallpaper=void 0,this.running=!1,this.gl.deleteProgram(this.pid),this.gl.deleteShader(this.vert),this.gl.deleteShader(this.frag),this.canvas.remove(),window.removeEventListener("resize",this.eventHandlerResize),window.removeEventListener("mousemove",this.eventHandlerMouse)}}function r(t){var e;return s(this,void 0,void 0,(function*(){if(null==t)return;const r=null===(e=t.attributes.getNamedItem("data-shader"))||void 0===e?void 0:e.value;null!=r&&(null!=(null==t?void 0:t.shaderWallpaper)?t.shaderWallpaper.destroy():t.shaderWallpaper=new i(yield function(t){return s(this,void 0,void 0,(function*(){if(t.includes("glslsandbox.com")&&t.includes("/e#")){t=t.replace("/e#","/item/");const e=yield fetch(t),i=yield e.json();if(void 0===i.code)throw new Error("Could not get shader code");return i.code}const e=yield fetch(t);return yield e.text()}))}(r),t))}))}document.addEventListener("DOMContentLoaded",(function t(){new MutationObserver((t=>{t.forEach((t=>r(t.target)))})).observe(document.body,{subtree:!0,childList:!1,attributeFilter:["data-shader"]}),console.log("start"),document.querySelectorAll("[data-shader]").forEach((t=>r(t))),document.removeEventListener("DOMContentLoaded",t)}))}(i||(e.WebShaderWallpaper=i={}))},607:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0});const s=i(549);e.default=s.WebShaderWallpaper,Object.assign(t.exports,s.WebShaderWallpaper)}},e={},i=function i(s){var r=e[s];if(void 0!==r)return r.exports;var a=e[s]={exports:{}};return t[s].call(a.exports,a,a.exports,i),a.exports}(607);WebShaderWallpaper=i})();
//# sourceMappingURL=WebShaderWallpaper.js.map