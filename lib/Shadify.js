var Shadify;(()=>{"use strict";var t={336:function(t,e){var i,s=this&&this.__awaiter||function(t,e,i,s){return new(i||(i=Promise))((function(a,r){function n(t){try{o(s.next(t))}catch(t){r(t)}}function h(t){try{o(s.throw(t))}catch(t){r(t)}}function o(t){var e;t.done?a(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(n,h)}o((s=s.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.Shadify=void 0,function(t){class e{constructor(t,e){if(this.running=!0,this.eventHandlerResize=this.resize.bind(this),this.eventHandlerMouse=this.mouse.bind(this),this._quality=2,this.speed=1,this.target=e,"CANVAS"===this.target.tagName)this.canvas=this.target;else{if(this.canvas=document.createElement("canvas"),e.append(this.canvas),e!==document.body){const t=getComputedStyle(e).borderRadius||0;e.style.clipPath=`inset(0 0 0 0 round ${t})`}this.canvas.style.position="fixed",this.canvas.style.left="0%",this.canvas.style.right="0%",this.canvas.style.top="0%",this.canvas.style.bottom="0%",this.canvas.style.width="100%",this.canvas.style.height="100%"}this.updateAttributes(),this.gl=this.canvas.getContext("webgl")||this.canvas.getContext("experimental-webgl"),this.loadShader(t);let i=new Float32Array([-1,3,-1,-1,3,-1]);this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.gl.createBuffer()),this.gl.bufferData(this.gl.ARRAY_BUFFER,i,this.gl.STATIC_DRAW);let s=this.gl.getAttribLocation(this.pid,"coords");this.gl.vertexAttribPointer(s,2,this.gl.FLOAT,!1,0,0),this.gl.enableVertexAttribArray(s),window.addEventListener("resize",this.eventHandlerResize),window.addEventListener("mousemove",this.eventHandlerMouse),new MutationObserver((t=>{this.updateAttributes()})).observe(e,{subtree:!1,childList:!1,attributes:!0,attributeFilter:["data-shader","data-shader-quality","data-shader-speed"]}),this.update()}loadShader(t){this.pid&&this.gl.deleteProgram(this.pid),this.vert&&this.gl.deleteShader(this.vert),this.frag&&this.gl.deleteShader(this.frag),this.pid=this.gl.createProgram(),this.vert=i(this.gl,"\n      attribute vec2 coords;\n      void main(void) {\n          gl_Position = vec4(coords.xy, 0.0, 1.0);\n      }\n  ",this.gl.VERTEX_SHADER),this.gl.attachShader(this.pid,this.vert),this.frag=i(this.gl,t,this.gl.FRAGMENT_SHADER),this.gl.attachShader(this.pid,this.frag),this.gl.linkProgram(this.pid),this.gl.useProgram(this.pid),this.uniformResolution=this.gl.getUniformLocation(this.pid,"resolution"),this.uniformTime=this.gl.getUniformLocation(this.pid,"time"),this.uniformMouse=this.gl.getUniformLocation(this.pid,"mouse")}updateAttributes(){var t,e,i,s;this.quality=Number(null===(t=this.target.attributes.getNamedItem("data-shader-quality"))||void 0===t?void 0:t.value)||this.quality,this.speed=Number(null===(e=this.target.attributes.getNamedItem("data-shader-speed"))||void 0===e?void 0:e.value)||this.speed,this.canvas.style.zIndex=(null===(i=this.target.attributes.getNamedItem("data-shader-z-index"))||void 0===i?void 0:i.value)||"-1",(null===(s=this.target.attributes.getNamedItem("data-shader"))||void 0===s?void 0:s.value)||this.destroy()}resize(){"CANVAS"!==this.target.tagName&&(this.canvas.width=window.innerWidth/this.quality,this.canvas.height=window.innerHeight/this.quality)}mouse(t){this.mouseX=t.clientX,this.mouseY=t.clientY}update(){const{width:t,height:e}=this.canvas;this.running&&(this.gl.uniform2f(this.uniformMouse,this.mouseX/t/this.quality,1-this.mouseY/e/this.quality),this.gl.uniform2f(this.uniformResolution,t,e),this.gl.uniform1f(this.uniformTime,performance.now()/1e3*this.speed),this.gl.viewport(0,0,t,e),this.gl.clearColor(0,0,0,0),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this.gl.drawArrays(this.gl.TRIANGLES,0,3),requestAnimationFrame(this.update.bind(this)))}getUniform(t){return this.gl.getUniformLocation(this.pid,t)}destroy(){this.target.shadify=void 0,this.running=!1,this.gl.deleteProgram(this.pid),this.gl.deleteShader(this.vert),this.gl.deleteShader(this.frag),this.canvas.remove(),this.pid=null,this.vert=null,this.frag=null,window.removeEventListener("resize",this.eventHandlerResize),window.removeEventListener("mousemove",this.eventHandlerMouse)}get quality(){return this._quality}set quality(t){this._quality=t,this.resize()}}function i(t,e,i){const s=t.createShader(i);if(t.shaderSource(s,e),t.compileShader(s),!t.getShaderParameter(s,t.COMPILE_STATUS))throw`Could not compile WebGL program. \n\n${t.getShaderInfoLog(s)}`;return s}function a(t){return s(this,void 0,void 0,(function*(){if(t.includes("glslsandbox.com")&&t.includes("/e#")){t=t.replace("/e#","/item/");const e=yield fetch(t),i=yield e.json();if(void 0===i.code)throw new Error("Could not get shader code");return i.code}const e=yield fetch(t);return yield e.text()}))}function r(t){var i;return s(this,void 0,void 0,(function*(){if(null==t)return;const s=null===(i=t.attributes.getNamedItem("data-shader"))||void 0===i?void 0:i.value;null!=s&&0!=s.trim().length&&(null!=(null==t?void 0:t.shadify)?t.shadify.target==t?t.shadify.loadShader(yield a(s)):t.shadify.destroy():(console.log(t),t.shadify=new e(yield a(s),t)))}))}document.addEventListener("DOMContentLoaded",(function t(){new MutationObserver((t=>{console.log(t,t.filter((e=>t.filter((t=>t.target==e.target)).length>=t.length-1))),t.filter((e=>t.filter((t=>t.target==e.target)).length>=t.length-1)).forEach((t=>r(t.target)))})).observe(document.body,{subtree:!0,childList:!1,attributeFilter:["data-shader"]}),document.querySelectorAll("[data-shader]").forEach((t=>r(t))),document.removeEventListener("DOMContentLoaded",t)}))}(i||(e.Shadify=i={}))},607:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0});const s=i(336);e.default=s.Shadify,Object.assign(t.exports,s.Shadify)}},e={},i=function i(s){var a=e[s];if(void 0!==a)return a.exports;var r=e[s]={exports:{}};return t[s].call(r.exports,r,r.exports,i),r.exports}(607);Shadify=i})();
//# sourceMappingURL=Shadify.js.map